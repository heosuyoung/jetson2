# MQTT ì„¤ì • ë° ì‚¬ìš© ê°€ì´ë“œ

## ğŸ—ï¸ **ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°**

```
ë¼ì¦ˆë² ë¦¬íŒŒì´ MQTT ë¸Œë¡œì»¤ (192.168.137.82)
    â†•ï¸
â”œâ”€â”€ Jetson (192.168.43.10) â†’ ìš´ì „ì ëª¨ë‹ˆí„°ë§ ë°ì´í„° ë°œí–‰
â”œâ”€â”€ ë°±ì—”ë“œ ì„œë²„ â†’ ë°ì´í„° ìˆ˜ì‹  ë° ì €ì¥
â””â”€â”€ Wear OS â†’ ê¸´ê¸‰ ìƒí™© ê°ì§€ ë° ì•Œë¦¼
```

---

## ğŸ“¡ **MQTT í† í”½ êµ¬ì¡°**

### **ë°œí–‰ í† í”½ (Jetson â†’ ë¸Œë¡œì»¤)**
```
car/{user_id}/alert      # ì•Œë¦¼ ë©”ì‹œì§€
car/{user_id}/status     # ìƒíƒœ ì •ë³´
```

### **êµ¬ë… í† í”½ (ë¸Œë¡œì»¤ â†’ í´ë¼ì´ì–¸íŠ¸)**
```
car/+/alert             # ëª¨ë“  ì‚¬ìš©ì ì•Œë¦¼
car/+/status            # ëª¨ë“  ì‚¬ìš©ì ìƒíƒœ
car/emergency/alert     # ê¸´ê¸‰ ìƒí™©
```

---

## ğŸš€ **ì‚¬ìš© ë°©ë²•**

### **1. Jetsonì—ì„œ MQTT í™œì„±í™”**

```bash
# MQTT ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ì—¬ ì‹¤í–‰
python3 v1ai_model_modified.py --enable_mqtt --user_id "DriverA"
```

**í‚¤ë³´ë“œ ì»¨íŠ¸ë¡¤:**
- `R`: ìš´ì „ì ì–¼êµ´ ë“±ë¡
- `I`: ìš´ì „ì ì‹ë³„
- `B`: Baseline ì¬ì¸¡ì •
- `ESC`: ì¢…ë£Œ

### **2. ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰**

```bash
# Spring Boot ì„œë²„ ì‹¤í–‰
./gradlew bootRun
```

**ë¡œê·¸ í™•ì¸:**
- MQTT ì—°ê²° ìƒíƒœ
- ìˆ˜ì‹ ëœ ì•Œë¦¼ ë©”ì‹œì§€
- ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ìƒíƒœ

### **3. Wear OS ì•± ì‹¤í–‰**

**MainActivityì—ì„œ MQTT ì—°ê²°:**
```kotlin
// MQTT ë§¤ë‹ˆì € ì´ˆê¸°í™” ë° ì—°ê²°
mqttManager = MqttManager(this)
mqttManager.connect()
```

---

## ğŸ§ª **í…ŒìŠ¤íŠ¸ ë°©ë²•**

### **1. MQTT ì—°ê²° í…ŒìŠ¤íŠ¸**

```bash
# Jetsonì—ì„œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
python3 test_mqtt.py
```

**ì˜ˆìƒ ê²°ê³¼:**
```
ğŸš€ MQTT ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘
   ë¸Œë¡œì»¤: 192.168.137.82:1883
   ì‚¬ìš©ì: moring
âœ… MQTT ë¸Œë¡œì»¤ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!
ğŸ“¤ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œí–‰ ì¤‘...
ğŸ“¨ ë©”ì‹œì§€ ìˆ˜ì‹  ëŒ€ê¸° ì¤‘...
```

### **2. ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ ë¸Œë¡œì»¤ ìƒíƒœ í™•ì¸**

```bash
# ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ í™•ì¸
mosquitto_sub -h localhost -t '$SYS/broker/clients/connected' -u moring -P change_me_123

# ë©”ì‹œì§€ í†µê³„ í™•ì¸
mosquitto_sub -h localhost -t '$SYS/broker/messages/stored' -u moring -P change_me_123
```

---

## ğŸ“Š **ë©”ì‹œì§€ í˜•ì‹**

### **ì¡¸ìŒ ê°ì§€ ì•Œë¦¼**
```json
{
  "type": "drowsiness",
  "timestamp": 1640995200.123,
  "data": {
    "ear": 0.15,
    "pitch": 12.5,
    "eye_threshold": 0.25,
    "pitch_threshold": 15.0
  }
}
```

### **ì‹œì„  ì´íƒˆ ì•Œë¦¼**
```json
{
  "type": "distraction",
  "timestamp": 1640995200.123,
  "data": {
    "yaw": 25.0,
    "roll": 18.0,
    "yaw_threshold": 20.0,
    "roll_threshold": 15.0
  }
}
```

### **íœ´ëŒ€í° ì‚¬ìš© ì•Œë¦¼**
```json
{
  "type": "phone_usage",
  "timestamp": 1640995200.123,
  "data": {
    "detected_objects": 1,
    "confidence": 0.85
  }
}
```

---

## ğŸ”§ **ë¬¸ì œ í•´ê²°**

### **1. MQTT ì—°ê²° ì‹¤íŒ¨**

**í™•ì¸ ì‚¬í•­:**
- ë¼ì¦ˆë² ë¦¬íŒŒì´ ë¸Œë¡œì»¤ ì‹¤í–‰ ìƒíƒœ
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ
- IP ì£¼ì†Œ ë° í¬íŠ¸ ë²ˆí˜¸
- ì‚¬ìš©ìëª…/ë¹„ë°€ë²ˆí˜¸

**í•´ê²° ë°©ë²•:**
```bash
# ë¸Œë¡œì»¤ ìƒíƒœ í™•ì¸
sudo systemctl status mosquitto

# ì—°ê²° í…ŒìŠ¤íŠ¸
mosquitto_pub -h 192.168.137.82 -t "test" -m "hello" -u moring -P change_me_123
```

### **2. ë©”ì‹œì§€ ìˆ˜ì‹  ì•ˆë¨**

**í™•ì¸ ì‚¬í•­:**
- í† í”½ êµ¬ë… ìƒíƒœ
- ë©”ì‹œì§€ ë°œí–‰ ìƒíƒœ
- ë„¤íŠ¸ì›Œí¬ ë°©í™”ë²½ ì„¤ì •

**í•´ê²° ë°©ë²•:**
```bash
# êµ¬ë… í…ŒìŠ¤íŠ¸
mosquitto_sub -h 192.168.137.82 -t "car/+/alert" -u moring -P change_me_123
```

---

## ğŸ“ **ì„¤ì • íŒŒì¼**

### **ë¼ì¦ˆë² ë¦¬íŒŒì´ MQTT ë¸Œë¡œì»¤ ì„¤ì •**
```conf
# /etc/mosquitto/mosquitto.conf
port 1883
log_type all
log_timestamp true
allow_anonymous true
password_file /etc/mosquitto/passwd
persistence true
persistence_location /var/lib/mosquitto/
max_connections 100
```

### **ë°±ì—”ë“œ ì„œë²„ ì„¤ì •**
```properties
# application.properties
mqtt.broker.url=tcp://192.168.137.82:1883
mqtt.client.id=backend_client
mqtt.username=moring
mqtt.password=kimoring
```

---

## âœ… **ì™„ë£Œ í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸**

- [ ] ë¼ì¦ˆë² ë¦¬íŒŒì´ MQTT ë¸Œë¡œì»¤ ì„¤ì¹˜ ë° ì‹¤í–‰
- [ ] Jetsonì—ì„œ MQTT í´ë¼ì´ì–¸íŠ¸ ì—°ê²°
- [ ] ë°±ì—”ë“œ ì„œë²„ì—ì„œ MQTT ë©”ì‹œì§€ ìˆ˜ì‹ 
- [ ] Wear OSì—ì„œ MQTT ì—°ê²°
- [ ] í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ë°œí–‰/ìˆ˜ì‹  í™•ì¸
- [ ] ì‹¤ì œ ìš´ì „ì ëª¨ë‹ˆí„°ë§ ë°ì´í„° ì „ì†¡ í™•ì¸

---

## ğŸ¯ **ë‹¤ìŒ ë‹¨ê³„**

1. **ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™**: ìˆ˜ì‹ ëœ ë°ì´í„°ë¥¼ DBì— ì €ì¥
2. **FCM í‘¸ì‹œ ì•Œë¦¼**: ê¸´ê¸‰ ìƒí™© ì‹œ í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡
3. **ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ**: ì›¹ ëŒ€ì‹œë³´ë“œë¡œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
4. **ì•Œë¦¼ ì„¤ì •**: ì‚¬ìš©ìë³„ ì•Œë¦¼ ì„¤ì • ê´€ë¦¬
